[workspace]
name = "combine_postfits"
version = "0.1.0"
description = "Plotter for combine postfits"
channels = ["conda-forge"]
platforms = ["linux-64"]

[tasks]
generate-baselines = "./tests/examples.sh all"
lint = "ruff check . && ruff format --check ."
lint-fix = "ruff check --fix . && ruff format ."
pre-commit-install = "prek install"

[dependencies]
python = ">=3.10,<3.13"
pip = "*"
root = ">=6.26"
ruff = "*"
prek = "*"

# Core dependencies
numpy = "*"
scipy = "*"
pyyaml = "*"
matplotlib = "*"

# PyPI dependencies installed via pip
[pypi-dependencies]
combine_postfits = { path = ".", editable = true }

[feature.test.dependencies]
pytest = "*"
pillow = "*"

[feature.test.tasks]
# TASK 1: Standard test (DEFAULT)
# Unit + integration + core visual tests (~44 images)
# Use for: CI/CD, pre-commit checks, regular development
test = "pytest tests/ -m 'not root'"

# TASK 2: Quick smoke test
# Unit + integration + single visual case (~6 images)
# Use for: Fast feedback during active development
test-quick = "pytest tests/unit/ tests/integration/ -v && pytest tests/visual/ -m quick -v"

# TASK 3: ROOT-dependent tests only
# Tests requiring native ROOT (plot_cov, rmap, etc.)
# Use for: Validating ROOT-specific features
test-root = "pytest tests/ -m root"

# TASK 4: Full test suite
# Everything including ROOT-dependent tests
# Use for: Pre-release validation, comprehensive checks
test-full = "pytest tests/ -m 'root or not root'"

# TASK 5: CI Matrix Test
# Subset of tests for version matrix checking
# Unit tests + Multiprocessing check + ROOT check
test-matrix = "pytest tests/unit/ && combine_postfits -i tests/fitDiags/fit_diag_A.root -o tests/matrix_out --p 2 --data --unblind && pytest tests/ -m root"

[feature.py310.dependencies]
python = "3.10.*"

[feature.py311.dependencies]
python = "3.11.*"

[feature.py312.dependencies]
python = "3.12.*"

[environments]
default = { features = ["test"], solve-group = "default" }
test = { features = ["test"], solve-group = "default" }
py310 = ["py310", "test"]
py311 = ["py311", "test"]
py312 = ["py312", "test"]
